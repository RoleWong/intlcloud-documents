データを喪失または破損させないために、自動バックアップまたは手動バックアップによってデータベースをバックアップできます。

## バックアップの概要
### バックアップモード
TencentDB for MySQL単一ノード（クラウドディスク）、2ノード（ローカルディスク）、および3ノード（ローカルディスク）は、**自動バックアップ**と**手動バックアップ**という2つのデータベースバックアップ方法をサポートしています。

### バックアップタイプ
TencentDB for MySQLの2ノード、3ノードは次の2種類のバックアップタイプに対応します。
- **物理バックアップ**は、物理データを完全コピーすることです（自動バックアップと手動バックアップの両方でサポート）。
- **論理バックアップ**は、SQLステートメントをバックアップすることです（手動バックアップでのみサポート）。
>?
>- 物理バックアップを使用してデータベースを復元するには、xbstreamを利用してパッケージを解凍してください。詳細については、[物理バックアップでデータベースを復元する](https://intl.cloud.tencent.com/document/product/236/31910)をご参照ください。
>- 単一インスタンスのテーブル数が100万を超えた場合は、バックアップのエラーになる恐れがあり、データベースへの監視にも影響を与えます。そのために、単一インスタンスのテーブル数が100万を超えないようにテーブルの数を適切に管理してください。
>- Memoryエンジンテーブルのデータがメモリに格納されているので、Memoryエンジンテーブルの物理バックアップを実行できません。データの紛失を避けるために、MemoryエンジンテーブルをInnoDBテーブルに置き換えることをお勧めします。
>- インスタンスにはプライマリキーのないテーブルが多数存在するため、バックアップに失敗し、インスタンスの高可用性に影響を与える可能性があります。プライマリキーのないテーブルのプライマリキーまたはセカンダリインデックスを適時に作成してください。

| 物理バックアップのメリット | 論理バックアップのデメリット |
|---------|---------|
| <li>バックアップ速度が速いです。<li>ストリーミングバックアップと圧縮をサポートします。<li>バックアップの成功率が高いです。<li>復元は簡単で効率的です。<li>バックアップとの結合作業、例えば、ROの増加、災害復旧の増加で速度がより速くなります。<li>物理バックアップにかかる平均時間は論理バックアップの1/8程度です。<li>物理バックアップのインポート速度は論理バックアップより10倍ほど速いです。| <li>復元するにはSQLの実行とインデックスの作成が必要なので、かかる時間が長くなります。<li>バックアップ速度が遅いです。大量のデータがある場合は特に速度が低下します。<li>バックアッププロセスは、インスタンスに負荷をかけ、マスター/スレーブの遅延を大きくする可能性があります。<li>単精度浮動小数点数の精度情報が紛失する可能性があります。<li>各種エラー（エラービューなど）によって、バックアップの失敗になる可能性があります。<li>バックアップとの結合作業、例えば、ROの増加、災害復旧の増加で速度が遅くなる可能性があります。</li> |

TencentDB for MySQL単一ノード（クラウドディスク）は、スナップショットバックアップをサポートしています。**スナップショットバックアップ**：ストレージレイヤーディスクのスナップショットを作成してバックアップします（自動バックアップと手動バックアップの両方に対応）。

| スナップショットバックアップのメリット | スナップショットバックアップのデメリット |
|---------|---------|
|<li>バックアップ速度が速いです。<li>使用する容量が比較的小さいです。|ダウンロードをサポートしていません。|


### バックアップのオブジェクト
 | データバックアップ | ログバックアップ |
|---------|---------|
 | MySQL 2ノード、3ノード：<li>自動バックアップは全データの物理バックアップをサポートしています。<li>手動バックアップは全データの物理バックアップ、全データの論理バックアップと単一データベース、単一テーブルの論理バックアップをサポートしています。<li>自動バックアップと手動バックアップの両方とも圧縮とダウンロードをサポートしています。<br>MySQL単一ノード（クラウドディスク）：<li>自動バックアップは全データのスナップショットバックアップをサポートしています。<li>手動バックアップは全データのスナップショットバックアップをサポートしています。<li>自動バックアップと手動バックアップの両方ともダウンロードをサポートしていません。 | データベースのbinlogログファイルバックアップはMySQL単一ノード（クラウドディスク）、2ノード、3ノードに対応可能：<li>ログファイルはインスタンスバックアップの容量を使用します。<li>ログファイルはダウンロードをサポートしていますが、圧縮をサポートしていません。<li>ログファイルの保存期間を設定できます。</li>|

## 注意事項
- MySQLの自動バックアップ機能は、2019年02月26日より、物理バックアップのみサポートされています。自動バックアップは、デフォルトで物理バックアップに設定され、論理バックアップを提供されなくなりました。既存の自動論理バックアップは、自動的に物理バックアップに切り替えられます。
この切り替え作業は、サービスへのアクセスに影響を与えませんが、自動バックアップを使う習慣のある方に若干の影響を与える可能性があります。論理バックアップを実行したい場合、 [MySQLコンソール](https://console.cloud.tencent.com/cdb) の手動バックアップ方法、或いは[APIの呼び出し](https://intl.cloud.tencent.com/document/product/236/15844)で論理バックアップを生成することができます。
- インスタンスバックアップファイル占用バックアップキャパシティについては、バックアップキャパシティを適切に使用してください。バックアップキャパシティが無料制限を超えたものには課金されます。 [バックアップスペース課金説明](https://intl.cloud.tencent.com/document/product/236/32344)をご参照ください。
- サービス量の少ない時期にデータベースをバックアップすることをお勧めします。
- 一定の保持期間を過ぎた場合、ファイルが自動的に削除されますので、必要なバックアップファイルをローカルにダウンロードしてください。
- テーブルロックによるバックアップの失敗を回避するために、バックアップ中は、DDL操作をしないでください。
- 単一ノードのMySQLインスタンスはデータベースのバックアップをサポートしていません。

## [MySQLデータの自動バックアップ](id:ZDBFSJ)
### 自動バックアップの設定
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストのページでインスタンスIDをクリックすると、管理ページに進み、**バックアップと復元** > **自動バックアップの設定**を選択します。
![](https://qcloudimg.tencent-cloud.cn/raw/da6aad42478cbbddba52d02b1d677238.png)
2. バックアップ設定のためのポップアップダイアログで、バックアップパラメータを選択し、**OK**をクリックします。パラメータの説明は以下のとおりです：
>?
>- [ロールバック機能](https://intl.cloud.tencent.com/document/product/236/7276) は、バックアップサイクルとバックアップ保持日数内のデータバックアップ + ログバックアップ（binlog）を基準にしています。自動バックアップ頻度と保持日数を短縮すると、インスタンスデータのロールバック期間の範囲に影響します。バックアップの設定は十分に検討してください。
>例えば、バックアップサイクルを月曜と木曜、保持日数を7日間に設定すると、7日以内（データバックアップとログの有効バックアップの実際の保存期間）の任意の時点でロールバックできます。
>- 自動バックアップしたものは手動で削除することはできませんが、バックアップ保持期間を設定して、期限がきたら自動削除することができます。
>- データバックアップとログバックアップの保持日数を追加すると予定外のバックアップキャパシティ費用が生じる恐れがあります。
>- ログバックアップの保持日数を短縮するとインスタンスのデータロールバックサイクルに影響する恐れがあります。

自動バックアップ設定で、データバックアップの設定は定期保持ポリシーの有効化をサポートします。以下、通常のバックアップと定期バックアップの有効化のためのパラメータ設定についてそれぞれ説明します。
>!定期バックアップの保持時間は通常バックアップに設定された保持時間よりも長くしてください。
>

### 通常バックアップの設定説明
| パラメータ     | 説明 | 
|---------|---------|
| バックアップ開始時間 | <li>デフォルトの時間はシステムが自動的に割り当てたバックアップ開始時刻です。<li>時間帯をカスタム設定でき、サービスの低いピーク期間に設定することをお勧めします。バックアップ開始時刻は、バックアップ終了時刻ではなく、バックアップが開始する時刻を表します。<br>例えば、02:00～06:00時を選択した場合、システムは、02:00～06:00の時間帯にある特定の時刻にバックアップを開始します。具体的な開始時刻は、バックエンドのバックアップポリシーとバックアップシステム状況に依存します。</br>| 
| データバックアップの保存時間 | <li>MySQL 2ノード、3ノードのデータバックアップファイルは7日～1830日保存可能で、デフォルトで7日間保存されます。期限を過ぎると、バックアップセットは自動削除されます。<li>MySQL単一ノード（クラウドディスク）のデータバックアップファイルは7日～1830日保存可能で、デフォルトで7日間保存されます。期限を過ぎると、バックアップセットは自動削除されます。| 
| バックアップサイクル | データの安全性を確保するために、少なくとも１週間に2回バックアップを実行してください。デフォルトは月曜日から日曜日までとします。| 
| ログバックアップの保存時間 | <li>MySQL 2ノード、3ノードのログバックアップファイルは7日～1830日保存可能で、デフォルトで7日間保存されます。期限を過ぎると、バックアップセットは自動削除されます。<li>MySQL単一ノード（クラウドディスク）のログバックアップファイルは7日～1830日保存可能で、デフォルトで7日間保存されます。期限を過ぎると、バックアップセットは自動削除されます。| 

![](https://qcloudimg.tencent-cloud.cn/raw/9c018f548a012b427daf0227f2a93642.png)

### [定期バックアップ設定を有効化する説明](id:DQBFBL)
>?単一ノード（クラウドディスク）のインスタンスは、現在定期的なバックアップ設定機能をサポートしていません。

| パラメータ     | 説明 | 
|---------|---------|
| バックアップ開始時間 | <li>デフォルトの時間はシステムが自動的に割り当てたバックアップ開始時刻です。<li>時間帯をカスタム設定でき、サービスの低いピーク期間に設定することをお勧めします。バックアップ開始時刻は、バックアップ終了時刻ではなく、バックアップが開始する時刻を表します。<br>例えば、02:00～06:00時を選択した場合、システムは、02:00～06:00の時間帯にある特定の時刻にバックアップを開始します。具体的な開始時刻は、バックエンドのバックアップポリシーとバックアップシステム状況に依存します。</br>| 
| データバックアップの保持時間 | データバックアップファイルは7日～1830日保持でき、デフォルト値は7日です。期限がきたらバックアップセットは自動削除されます。| 
| バックアップサイクル | データの安全性を確保するために、少なくとも１週間に2回バックアップを実行してください。デフォルトは月曜日から日曜日までとします。| 
| 定期バックアップの保持時間 | データバックアップファイルは90日～3650日保持でき、デフォルト値は1080日です。保持期限がきたらバックアップセットは自動削除されます。| 
| 定期バックアップ保持ポリシー | 月、四半期または年ごとのバックアップ保持数の設定をサポートします。| 
| 開始時刻 | 定期保持バックアップの開始時刻を実行します。| 
| ログバックアップの保持時間 | ログバックアップファイルは7日～1830日保持でき、デフォルト値は7日です。期限がきたらバックアップセットは自動削除されます。| 

![](https://qcloudimg.tencent-cloud.cn/raw/78c89e11aa7acab08de33b2f609fc56e.png)

### 保持計画の確認
バックアップ設定で定期バックアップ保持ポリシーを選択した後、**保持計画を確認**をクリックしてプレビューが表示されます。
![](https://qcloudimg.tencent-cloud.cn/raw/9b7c21feff9bf1409c80f745fbf1d370.png)
- 青い日付は通常バックアップの期日を意味します。
- 赤い日付は定期バックアップの期日を意味します。
- 通常バックアップまたは定期バックアップをクリックして、プレビューのため、対応する日付の色分けを非表示します。
- バックアップ計画のプレビューは今後1年間のバックアップ保持状況であり、参考用です。

デモ1：バックアップサイクルは月曜、水曜、金曜、日曜。2022年1月11日から、各月に1つのバックアップを保持します。
![](https://qcloudimg.tencent-cloud.cn/raw/9815814482b467916689b36d7f7b523b.png)
デモ2：バックアップサイクルは月曜、水曜、金曜。2022年1月11日から、各四半期に3つのバックアップを保持します。
![](https://qcloudimg.tencent-cloud.cn/raw/9815814482b467916689b36d7f7b523b.png)
デモ3：定期バックアップのみが表示されます。
![](https://qcloudimg.tencent-cloud.cn/raw/ec59982c8f84ae59e652f5efdfb65996.png)


## [MySQLデータの手動バックアップ](id:manual-backup)
手動バックアップ機能を使用すると、バックアップタスクを手動で開始できます。
>?
>- MySQL 2ノード、3ノードのインスタンスの手動バックアップは、全データの物理バックアップ、全データの論理バックアップ、および単一データベース、単一テーブルの論理バックアップをサポートしています。
>- MySQL 2ノード、3ノードのインスタンスの手動バックアップをバックアップリストで手動で削除することで、バックアップ容量をリリースして、容量の浪費と不必要な使用を回避できます。手動で削除しない限り、データベースインスタンスがオフラインになるまで保存されます。
>- MySQL単一ノード（クラウドディスク）のインスタンスは全データのスナップショットバックアップをサポートしています。
>- MySQL単一ノード（クラウドディスク）のインスタンスの手動バックアップは削除をサポートしていません。
>- インスタンスは毎日の自動バックアップタスクを実行する期間内に手動バックアップを開始することができません。

**MySQL 2ノード、3ノードのインスタンスの操作手順**
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストのページでインスタンスIDをクリックすると、管理ページに進み、**バックアップと復元** > **自動手動バックアップ**を選択します。
2. バックアップ設定のポップアップダイアログで、バックアップ方法とオブジェクトを選択して、備考名を入力し、**OK**をクリックします。
![](https://main.qcloudimg.com/raw/a16e644f51756b6a98597945e45329cd.png)
>?単一データベース/テーブルの論理バックアップの場合、左側の**データベースとテーブルの選択**でバックアップするデータベース又はテーブルを選択し、データベース又はテーブルを右側のリストに追加します。データベースがない場合は、まずデータベース或いはテーブルを作成してください。
>
![](https://main.qcloudimg.com/raw/76924e2c76ac348b68ed113d679d6907.png)

**MySQL単一ノード（クラウドディスク）のインスタンスの操作手順**
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストでターゲットインスタンスIDをクリックして管理ページに移動してから、**バックアップ復元** > **手動バックアップ**を選択します。
2. 備考名を入力し、**確定**をクリックします。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/ydfQ183_17.png)

## よくあるご質問
#### 1. バックアップ保持期間が過ぎたバックアップは、まだダウンロードや元に戻すことができますか？
期限切れのバックアップセットは自動的に削除され、ダウンロードまたは復元できません。
- 必要に応じてバックアップ保存時間を適切に設定する、または[MySQLコンソール](https://console.cloud.tencent.com/cdb)でバックアップファイルをデバイス内にダウンロードすることをお勧めします（注意：単一ノードのクラウドディスクインスタンスのバックアップファイルは、現在ダウンロードをサポートしていません）。
- コンソールでインスタンスデータを手動でバックアップすることもでき、手動バックアップは永続的に保持されます。
>?手動バックアップは、バックアップキャパシティを占用することもあります。バックアップキャパシティを適切に使用して、予定外の費用が生じないようにしてください。

#### 2. バックアップは手動で削除できますか？
- 自動バックアップしたものは手動で削除することはできませんが、バックアップ保持期間を設定して、期限がきたら自動削除することができます。 
- 2ノード、3ノードのインスタンスの手動バックアップは、[MySQLコンソール](https://console.cloud.tencent.com/cdb)のバックアップリストから手動で削除できます。単一ノードのクラウドディスクインスタンスの手動バックアップは、現在削除をサポートしていません。手動で削除しない限り、バックアップは永久に保存されます。

#### 3. データとログのバックアップは停止できますか？
無効にできません。ただし、[MySQLコンソール](https://console.cloud.tencent.com/cdb)からバックアップ頻度を削減し、今後使用しない手動バックアップデータを削除することで、バックアップ容量の使用量を削減することができます（単一ノードのクラウドディスクインスタンスの手動バックアップは、現在削除をサポートしていません）。

#### 4. どうやってバックアップキャパシティのオーバーヘッドを減らしますか？
- 今後使用しない手動バックアップデータを削除します（手動バックアップは[MySQLコンソール](https://console.cloud.tencent.com/cdb)のインスタンス管理ページ > バックアップ復元ページで削除できます。注意：単一ノードのクラウドディスクインスタンスの手動バックアップは、現在削除をサポートしていません）。 
- 非コアビジネスのデータの自動バックアップ頻度を減らします（コンソールでバックアップ周期とバックアップ保留時間を調整することができ、1週間に少なくとも2回バックアップします）。
>?[ロールバック機能](https://intl.cloud.tencent.com/document/product/236/7276) は、バックアップサイクルとバックアップ保持日数内のデータバックアップ+ ログバックアップ(binlog)を基準にしています。自動バックアップ頻度と保持日数を短縮すると、インスタンスデータのロールバック期間の範囲に影響します。バックアップの設定は十分に検討してください。
>
- 非コアビジネスのデータバックアップおよびログバックアップの保存時間を短縮します(7日間のバックアップ保留時間は、既に大部分のシナリオの要件を満たすことができます)。

| サービスケース             | バックアップ保留時間                                                 |
| -------------------- | ------------------------------------------------------------ |
| 中核サービス             | 7日 - 1830日をお勧めします                                              |                               　
| 中核でない、データ類でないサービス | 7日をお勧めします                                                       |                                                  
| アーカイブ類サービス             | バックアップの保留時間を7日間とし、実際のサービスニーズにより手動でデータをバックアップし、使い終わったら適時に削除することをお勧めします |
| テスト類サービス             | バックアップの保留時間を7日間とし、実際のサービスニーズにより手動でデータをバックアップし、使い終わったら適時に削除することをお勧めします |

