## ユースケース

ここでは、Spring Cloudで開発されたプロデューサーとコンシューマーのDemoアプリケーションプログラムにより、JARパッケージのアップロードデプロイ方法を採用して、マイクロサービスアプリケーションをTEMにデプロイし、アプリケーションを相互に呼び出して、パブリックネットワークでアクセスできるようにする方法をご説明します。

##  前提条件

環境の新規作成とアプリケーションの新規作成が完了している必要があります。

## 操作手順

### 手順1：Demoアプリケーションの取得

TEMが現在サポートしているレジストリ設定センターは、Nacos、Zookeeper、Eureka(既存) です。以下の操作は、レジストリ設定センターのNacosを例にしています。レジストリ設定センターのSpring Cloudマイクロサービスアプリケーションの使用方法をデモンストレーションするため、レジストリ設定センターNacosのプロデューサー-コンシューマーDemoアプリケーションプログラムを使用します。これらのDemoアプリケーションの[ソースコード](https://github.com/tencentyun/tse-simple-demo)はGithubで確認するか、またはJARパッケージによって直接ダウンロードすることができます。

 レジストリ設定センターNacosのDemoアプリケーション：[Provider Demo](https://tem-demo-1305738457.cos.ap-shanghai.myqcloud.com/nacos-provider-demo-2.0.1.RELEASE.jar)および[Consumer Demo](https://tem-demo-1305738457.cos.ap-shanghai.myqcloud.com/nacos-consumer-demo-2.0.1.RELEASE.jar)。


### ステップ2：レジストリ設定センターの設定

Spring Cloud Demoアプリケーションのデプロイを開始する前に、**環境**に**レジストリ設定センター**リソースを設定する必要があります。[環境リソースの追加](https://intl.cloud.tencent.com/document/product/1094/40361)の操作手順を参照して、選択したアプリケーションに対応するレジストリ設定センターを追加してください。


### 手順3：アプリケーションのデプロイ

1. アプリケーション管理ページでデプロイしたいアプリケーションを選択し、**新しい環境にデプロイ**をクリックします。
![](https://qcloudimg.tencent-cloud.cn/raw/7cacf350dd2e2b5f9254ae4c70c2c0eb.png)
2. アプリケーションデプロイページで、アプリケーションの具体的な状況に応じて関連パラメータを設定します。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/gNJD139_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230104104641.png)
   - パッケージのアップロード：パッケージをアップロードします。
   - 環境の公開：今作成した環境を選択します。
   - アプリケーションでその他の詳細オプションを設定する必要がある場合は、[アプリケーションの作成とデプロイ](https://intl.cloud.tencent.com/document/product/1094/40362)をご参照ください。
3. Spring Cloudアプリケーションに対して、選択した**パブリッシュ環境**が**レジストリ設定センター**にバインドされている場合、デプロイプロセスの**アクセス設定**はレジストリ設定センター情報の自動挿入を選択することができます。登録と検出の具体的な操作フローと設定情報については [アプリケーションの登録と検出](https://intl.cloud.tencent.com/document/product/1094/40960)をご参照ください。
4. **デプロイ**をクリックし、consumerアプリケーションのデプロイを完了します。
5. **ステップ1～4**を繰り返し、providerアプリケーションのデプロイを完了します。



### 手順4：登録済みアプリケーションの確認

1. デプロイするアプリケーションインスタンスの実行が開始されたら、マイクロサービスエンジンコンソールの[レジストリ設定センター](https://console.cloud.tencent.com/tse/zookeeper)に進み、リストからデプロイ環境にバインドされているレジストリ設定センターを選択します。
2. レジストリ設定センターの詳細ページで、**サービス管理**ページを選択し、providerとconsumerのアプリケーションの登録が成功しているか確認します。



### 手順5：アクセスの検証

デプロイおよび登録に成功したプロバイダ-コンシューマーアプリケーションは、コンシューマーアプリケーションの**CLBゲートウェイ**にゲートウェイ設定を作成することにより、パブリックネットワークを介してアクセスすることができます。
<img src="https://qcloudimg.tencent-cloud.cn/raw/2aed6ac69e638b09e6b010083697ec26.png" width="80%">

1. TEMコンソールのサイドバーで[**CLBゲートウェイ**](https://console.cloud.tencent.com/tem/gateway?rid=33)を選択します 
2. **新規作成**をクリックし、ゲートウェイ設定の新規作成ページに進み、ゲートウェイ設定情報を入力し、**所属環境**でアプリケーションをデプロイする環境を選択します。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/y5d9759_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230104103532.png)
   
   - ネットワークタイプ：パブリックネットワークアクセスです。環境内へのアクセスが必要な場合は、[アプリケーションの作成とデプロイ](https://intl.cloud.tencent.com/document/product/1094/40362)をご参照ください。
   - ロードバランサ：自動作成または既存のものを使用。
   - プロトコルとポート：`HTTP:80`と`HTTPS:443`をサポートし、かつHTTPSドメイン名バインド証明書をサポートします。Demoアプリケーションでは`HTTP：80`を選択してください。
   - IPバージョン：`IPv4`および`IPv6 NAT64`をサポートしています。
   - 転送構成：
     - ドメイン名：既存ドメイン名のバインドをサポートしています。ドメイン名がない場合は、デフォルトでIPv4 IPが割り当てられます。Demoアプリケーションにはデフォルトで割り当てられたIPを使用してください。
     - パス：デフォルトは「/」で、実際の状況に応じて設定します
     バックエンドアプリケーション：デプロイしたconsumer Demoアプリケーションを選択します。
     - アプリケーションポート：consumer demoアプリケーションはポート19003を使用してください。
   - サーバー証明書：HTTPプロトコルを選択する場合は、サーバー証明書を選択する必要があります。既存の証明書が適切でない場合は、[サーバー証明書の新規作成](https://console.cloud.tencent.com/clb/cert)に移動できます
4. **確定**をクリックして、ゲートウェイ設定の新規作成を完了します。**CLBゲートウェイリストページ**で、アプリケーションのパブリックネットワークのアクセスIPを確認できます。
![](https://main.qcloudimg.com/raw/750e0fa57660b8b13f84ae439032b056.png)
5. ブラウザに次のURLを入力します。
   ```plaintext
   http://パブリックネットワークアクセスIP/echo/str
   ```
   ​次の結果が返された場合、アプリケーションのデプロイは成功していることを意味します。
   ```plaintext
   Hello Nacos Provider str
   ```
