## 概要

バケットにファイルをアップロードすると、Cloud Object Storage(COS)は自動的にファイルへのリンク（ファイルのURL）を生成し、ファイルのURL（つまりCOSのデフォルトドメイン名）から直接このファイルにアクセスできるようになります。CDNや独自ドメイン名でCOS上のファイルにアクセスしたい場合は、CDNドメイン名や独自ドメイン名を、ファイルが配置されているバケットにバインドする必要があります。

実際の必要性に応じて、対応するドメイン名を使用してファイルにアクセスすることができます。例えば、CDNアクセラレーションによってファイルにアクセスしたい場合、CDNアクセラレーションドメイン名が発行するファイルへのリンクにアクセスする必要があります。

## 設定の説明

ユーザーは以下のドメイン名を管理することで、バケット内のオブジェクトの高速ダウンロードと配布を可能にします。

- デフォルトドメイン名：COSオリジンサーバーのドメイン名であり、バケットの作成時に、システムがバケット名およびリージョンに基づいて自動的に生成するものです。
- カスタムCDNアクセラレーションドメイン名：ユーザーはバケットを使用する際、登録済みのカスタムドメイン名をTencent Cloudの国内CDNアクセラレーションプラットフォームにバインドすることで、カスタムドメイン名によってバケット内のオブジェクトにアクセスすることが可能になります。（以前に旧バージョンのCOSコンソールで「カスタムドメイン名」を使用したことがある場合は、新バージョンのコンソールで「カスタムCDNアクセラレーションドメイン名」とは表示されず、 「カスタムドメイン名」のままとなります）
- カスタムオリジンサーバードメイン名：ユーザーは登録済みのカスタムドメイン名を現在のバケットにバインドすることで、カスタムドメイン名によってバケット内のオブジェクトにアクセスすることが可能になります。

> !現在COSでカスタムドメイン名を使用している場合は、CDNアクセラレーションドメイン名を有効にする必要があります。ご自身の状況に応じて判断してください。
>- ドメイン名で国内のCDNにアクセスするには、ICP登録が必要です。ただしICP登録はTencent Cloudを通じて行わなくてもよく、アクセスするドメイン名が確実にICP登録されていればアクセスできます。
>- ドメイン名で海外のCDNにアクセスする場合は、ICP登録の必要はありません。ただし、Tencent Cloud上で保存するデータおよび操作行為については、関係国の法律法令、ならびに[『Tencent Cloudサービス契約』](https://intl.cloud.tencent.com/document/product/301/12905)を遵守する必要があることに必ずご注意ください。

カスタムCDNアクセラレーションドメイン名に対してCDNアクセラレーションが有効になっており、オリジンサーバーがパブリック読み取りバケットの場合、システムはデフォルトで、ユーザーがカスタムCDNアクセラレーションドメイン名によってオリジンサーバー内のオブジェクトに直接アクセスできるようにします。オリジンサーバーがプライベート読み取りバケットの場合は、CDN back-to-origin認証とCDN認証の設定という2つのオプションを有効にすることをお勧めします。

- back-to-origin認証（CDNサービス承認が追加されていることを前提とします）：ユーザーのリクエストしたデータがエッジノードでキャッシュにヒットしなかった場合、CDNはback-to-originを行ってデータ内容を取得する必要があります。COSをオリジンサーバーとして使用し、back-to-origin認証を有効にすると、CDNエッジノードは特殊なサービスID（CDNサービスによって承認され、取得する必要があるアイデンティティ）を使用してCOSオリジンサーバーにアクセスし、プライベートアクセスバケット内のデータの取得とキャッシュを実現することができます。
- CDN認証設定：ユーザーがエッジノードにアクセスしてキャッシュデータを取得する際、エッジノードは認証設定ルールに基づいて、URLアクセスにおけるID認証フィールドを検証することで、権限のないアクセスを防止し、リンク不正アクセス防止を実現し、エッジノードのキャッシュデータの安全性と信頼性を高めます。

CDN認証設定とCDN back-to-origin認証の使用は競合しませんが、2つの設定ステータスによってデータ保護効果は下表のように異なります。

| バケットへのアクセス権限       | CDN back-to-origin認証を有効にしているか | CDN認証設定を有効にしているか | CDNアクセラレーションドメイン名によって<br>オリジンサーバーにアクセス可能か | COSオリジンサーバードメイン名によって<br>オリジンサーバーにアクセス可能か | 適用ケース     |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| パブリック読み取り              | 無効         | 無効         | アクセス可          | アクセス可          | 全サーバーパブリックアクセス |
| パブリック読み取り              | 有効         | 無効         | アクセス可          | アクセス可          | 非推奨       |
| パブリック読み取り              | 無効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| パブリック読み取り              | 有効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 有効         | URLを使用した認証が必要 | COSを使用した認証が必要 | 全リンク保護   |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 有効         | URLを使用した認証が必要       | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 無効         | アクセス可          | COSを使用した認証が必要 | オリジンサーバー保護    |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 無効         | アクセス不可        | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り              | 無効         | 有効または無効   | アクセス不可        | COSを使用した認証が必要 | CDN利用不可 |

> !
> - 上記リストの最初の行を例に取ると、オリジンサーバーバケットのアクセス権限がパブリック読み取りであり、CDN back-to-origin認証もCDN認証設定も有効にしていない場合、CDNドメイン名でCDNエッジノードとオリジンサーバーバケットに、COSドメイン名でオリジンサーバーバケットに直接アクセスすることができます。
> - 上記の表中の**オリジンサーバー保護**のケースでは、CDN認証設定を有効にしていない場合、CDNエッジノードにキャッシュしたデータが悪意をもってプルされるおそれがあるため、同時にCDN認証設定を有効にすることでデータの安全性を保障するよう、強く推奨します。
> - ユーザーがカスタムドメイン名でCDNアクセラレーションを有効化すると、このドメイン名によって誰でもオリジンサーバーに直接アクセスできるようになります。従って、データに一定のプライバシーが存在する場合は、必ず**認証設定**からオリジンサーバーデータを保護してください。

## 関連する操作

- [カスタムCDNアクセラレーションドメイン名の有効化](https://www.tencentcloud.com/document/product/436/31505)
- [カスタムオリジンサーバードメイン名の有効化](https://intl.cloud.tencent.com/document/product/436/31507)
- [サブアカウントにバケットのアクセラレーションドメイン名を設定する権限を付与](https://intl.cloud.tencent.com/document/product/436/31712)
- [カスタムドメイン名の設定によるHTTPSアクセスのサポート](https://intl.cloud.tencent.com/document/product/436/11142)
