## 概要

Cloud Object Storage（COS）コンソールから、バケットにポリシーを追加して、ポリシーで設定されたCOSリソースへのアカウント、ソースIP（またはIPセグメント）のアクセスを許可または禁止することができます。バケットポリシーの概要やポリシー事例の関連情報については、[アクセスポリシーの言語概要](https://intl.cloud.tencent.com/document/product/436/18023)と[バケットポリシーの例](https://intl.cloud.tencent.com/document/product/436/45235)をご参照ください。次に、バケットポリシーを追加する方法について詳しくご説明します。

>! ルートアカウントごとに、最大1000個のバケットACLルールを作成できます。
>

##  前提条件

バケットを作成します。詳細については、[バケットの作成](https://intl.cloud.tencent.com/document/product/436/13309)のドキュメントをご参照ください。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションバーで**バケットリスト**をクリックし、バケットリストページに進みます。
3. バケットポリシーを追加したいバケットを見つけ、その名称をクリックし、バケット設定ページに進みます。
3. 左側ナビゲーションバーで**権限管理 > Policy権限の設定**をクリックします。COSは、バケットポリシーを追加する方法として次のものを提供しており、そのいずれかの方法でバケットポリシーを追加することができます。設定項目の詳細については、[アクセスポリシーの言語概要](https://intl.cloud.tencent.com/document/product/436/18023)をご参照ください。

<dx-tabs>
::: グラフィック設定
グラフィック設定パネルで、**ポリシーの追加**をクリックし、ポップアップウィンドウでポリシーを設定します。操作手順は次のとおりです。

（1）テンプレートの選択

COSは、異なる被付与者やリソース範囲の組み合わせを選択することで、さまざまなポリシーテンプレートを提供し、バケットポリシーの速やかな設定を支援します。

- 被付与者
 - **すべてのユーザー（匿名アクセス可能）**：匿名ユーザーに操作権限を開放したい場合は、このオプションを選択すると、次のポリシー設定の手順ですべてのユーザーが自動的に追加されます（`*`と表記されます）。オブジェクトリスト（ListBucket）をリストアップしたり、バケット設定権限などの操作を匿名ユーザーに開放したりするのは危険なため、このオプションを選択すると、COSは対応するテンプレートを提供しません。必要な場合は、その後の「ポリシーの設定」において、ご自分で追加することができます。
 - **ユーザーの指定**：指定するサブアカウント、ルートアカウントまたはクラウドサービスに操作権限を開放したい場合は、ユーザーを指定することができます。この場合、次の手順でポリシーを設定する際に、具体的なアカウントUINを指定する必要があります。

 **Note:**
   - 被付与者が指定のアカウントである場合、オブジェクトのリクエストの際に、ID認証用の署名を含める必要があります。署名に関する説明については、[リクエスト署名](https://intl.cloud.tencent.com/document/product/436/7778)をご参照ください。
   - 被付与者をすべてのユーザーに指定している場合、オブジェクトのリクエストの際に署名を含める必要はなく、すべてのユーザーが直接リンクを通じてオブジェクトにアクセスできます。データ漏洩のリスクがありますので、慎重に設定してください。

- リソース範囲
 - **バケット全体**：バケットの設定に関する権限を設定したい場合、またはリソース範囲としてバケット全体を指定したい場合は、この項目を選択できます。次の手順でポリシーを設定する際に、バケット全体がリソースとして自動的に追加されます。
 - **ディレクトリの指定**：リソースの範囲を指定したフォルダに限定したい場合、この項目を選択します。次の手順でポリシーを設定する際に、さらに具体的なディレクトリを指定する必要があります。この項目を選択した場合、このタイプの権限はリソースをバケット全体として指定する必要があるため、COSは、バケット設定に関するポリシーテンプレートを提供しません。

- テンプレート：お客様が承認したい操作セットです。
 - **カスタムポリシー（プリセット設定はご提供していません）**：テンプレートをご利用にならない場合はこの項目を選択し、次のステップの「ポリシーの設定」で、必要に応じてご自身でポリシーを追加できます。
 - **その他のテンプレート**：COSはお客様が選択した被付与者およびリソース範囲の組み合わせに基づき、それぞれに推奨するテンプレートをご提供します。必要なテンプレートにチェックを入れると、次のステップのポリシー設定で、COSが自動的に必要な操作を追加します。
 **Note:** テンプレートで提供される承認操作がニーズに合わない場合は、次の「ポリシーの設定」の手順で承認操作を追加または削除することができます。

テンプレートの説明は次の表をご参照ください。

<table>
   <tr>
      <th style="width:10%">被付与者</td>
      <th style="width:5%">リソース範囲</td>
      <th style="width:15%">ポリシーテンプレート</td>
      <th style="width:20%">説明</td>
   </tr>
   <tr>
      <td colspan=2>すべての組み合わせ</td>
      <td>カスタムポリシー</td>
      <td>任意の被付与者、リソース範囲の組み合わせの場合、このテンプレートを選択するとプリセットポリシーのご提供は行われません。次のステップのポリシー設定で、ご自身でポリシーを直接追加することができます。</td>
   </tr>
   <tr>
      <td rowspan=4>すべてのユーザー（匿名アクセス可能）</td>
      <td rowspan=2>バケット全体</td>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含まない）</td>
      <td rowspan=4>匿名ユーザーの場合、COSはファイル読み取り（ダウンロードなど）、ファイル書き込み（アップロード、変更など）の推奨テンプレートをご提供します。<br><br>COSの推奨テンプレートには、バケット内の全オブジェクトのリストアップ、読み取り/書き込み権限、バケット設定などのその他の機密性の高い権限は含まれず、他の余分な権限を開放しないようにすることで、データの安全性を高めています。<br><br>必要に応じて、後のステップでご自身で動作権限を追加または削除することができます。</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含まない）</td>
   </tr>
   <tr>
      <td rowspan=2>指定ディレクトリ</td>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含まない）</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含まない）</td>
   </tr>
   <tr>
      <td rowspan=11>指定ユーザー</td>
      <td rowspan=7>バケット全体</td>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含まない）</td>
      <td rowspan=7>指定ユーザーとバケット全体の組み合わせの場合、COSは最も多くの推奨テンプレートをご提供します。ファイル読み取り、書き込みおよびファイルリストアップのほか、次のような機密性の高い権限のテンプレートも含まれ、これらは信頼できるユーザーへの使用に適しています。<br>バケットおよびオブジェクトACLの読み取り/書き込み：GetObjectACL、PutObjectACL、GetBucketACL、PutBucketACLを含む、バケットACLとオブジェクトACLを取得、変更します。<br>バケット一般設定項目：バケットタグ、クロスドメイン、back-to-originなどの機密性が高くない権限です。<br>バケットの機密性の高い設定項目：バケットポリシー、バケットACL、バケット削除などにかかわる機密性の高い権限であり、慎重に使用する必要があります。</td>
   </tr>
   <tr>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含む）</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含まない）</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含む）</td>
   </tr>
   <tr>
      <td>バケットおよびオブジェクトの読み取り/書き込みACL</td>
   </tr>
   <tr>
      <td>バケット一般設定項目</td>
   </tr>
   <tr>
      <td>バケットの機密性の高い設定項目</td>
   </tr>
   <tr>
      <td rowspan=4>指定ディレクトリ</td>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含まない）</td>
      <td rowspan=4>指定ユーザーと指定ディレクトリの組み合わせの場合、COSはファイル読み取り（ダウンロードなど）、ファイル書き込み（アップロード、変更など）以外にも、オブジェクトリストのリストアップ権限を含む推奨テンプレートをご提供します。<br>指定したユーザー向けに指定したフォルダのファイルの読み取り、書き込み、リストアップ権限を開放したい場合は、この組み合わせを選択することをお勧めします。<br>必要に応じて、後のステップでご自身で動作権限を追加または削除することができます。</td>
   </tr>
   <tr>
      <td>読み取り専用オブジェクト（オブジェクトリストのリストアップを含む）</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含まない）</td>
   </tr>
   <tr>
      <td>読み取り/書き込みオブジェクト（オブジェクトリストのリストアップを含む）</td>
   </tr>
</table>

（2）ポリシーの設定

手順1で選択した被付与者、指定ディレクトリおよびテンプレートの組み合わせに対し、COSはポリシー設定において対応する操作、被付与者、リソースなどを自動的に追加します。お客様が指定ユーザー、指定ディレクトリを選択された場合は、ポリシー設定の際に具体的なユーザーUINとディレクトリを指定する必要があります。

COSがご提供する推奨テンプレートがニーズに合わない場合は、お客様ご自身でポリシーの内容を調整し、被付与者、リソースおよびアクションを追加または削除することもできます。設定項目の説明は次のとおりです。
- エフェクト：「許可」または「拒否」を選択できます。ポリシー構文の「allow」と「deny」に対応します。
- ユーザー：すべてのユーザー(`*`)、ルートアカウント、サブアカウント、クラウドサービスを含む被付与者を追加、削除できます。
- リソース：バケット全体または指定ディレクトリのリソースを追加できます。
- アクション：権限付与が必要な操作を追加、削除します。
- 条件：ユーザーのアクセスIPの制限など、権限付与の際の指定条件です。

（3）設定情報の確認

  設定情報が正しいことを確認したら、**完了**をクリックします。このときにサブアカウントを使用してCOSコンソールにログインすると、ポリシーで設定されたリソースの範囲にしかアクセスできなくなります。

:::
::: ポリシー構文
（1）**編集**をクリックし、定義したポリシー構文を入力します。COSは、さまざまなシナリオに対応したポリシー構文を提供しています。詳細については、[COS API権限承認ポリシー使用ガイド](https://intl.cloud.tencent.com/document/product/436/30580)をご参照ください。
（2）ポリシー構文が正しいことを確認し、保存をクリックすれば完了です。このときにサブアカウントを使用してCOSコンソールにログインすると、ポリシーで設定されたリソースの範囲にしかアクセスできなくなります。
:::
</dx-tabs>


